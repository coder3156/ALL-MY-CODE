import discord
from discord.ext import commands
from datetime import datetime

intents = discord.Intents.default()
intents.message_content = True
intents.members = True

bot = commands.Bot(command_prefix="!", intents=intents)

# Store AFK users {user_id: {"reason": str, "since": datetime}}
afk_users = {}

@bot.command()
async def afk(ctx, *, reason: str = "AFK"):
    """Set AFK with reason"""
    afk_users[ctx.author.id] = {"reason": reason, "since": datetime.utcnow()}
    await ctx.send(f"{ctx.author.mention} is now AFK: {reason}")

@bot.event
async def on_message(message):
    if message.author.bot:
        return

    # Remove AFK if user sends a message
    if message.author.id in afk_users:
        del afk_users[message.author.id]
        await message.channel.send(f"ðŸ‘‹ Welcome back {message.author.mention}, AFK removed.")

    # If mentions an AFK user
    for mention in message.mentions:
        if mention.id in afk_users:
            data = afk_users[mention.id]
            reason = data["reason"]
            since = data["since"]

            elapsed = datetime.utcnow() - since
            seconds = int(elapsed.total_seconds())

            if seconds < 60:
                ago = f"{seconds} seconds ago"
            elif seconds < 3600:
                minutes = seconds // 60
                ago = f"{minutes} minute{'s' if minutes != 1 else ''} ago"
            else:
                hours = seconds // 3600
                ago = f"{hours} hour{'s' if hours != 1 else ''} ago"

            current_time = datetime.now().strftime("%I:%M %p")

            reply = (
                f"{mention.mention} is AFK: {reason} â€“ {ago}\n"
                f"Current time: **{current_time}**"
            )
            await message.channel.send(reply)

    await bot.process_commands(message)

bot.run("YOUR_BOT_TOKEN")


